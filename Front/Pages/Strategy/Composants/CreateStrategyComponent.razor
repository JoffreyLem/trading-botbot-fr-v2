@using StrategyApi.StrategyBackgroundService.Dto
@using RobotAppLibraryV2.Modeles
@inherits CreateStrategyComponentBase


<div>
    <div id="target">
        <div>
            <button class="e-btn" @onclick="@CreateStrategy">Open strategy</button>
        </div>
        @if (ShowForm)
        {
            <div style="display: flex;">
                <div style="flex: 1; padding-right: 10px;">
                    <EditForm Model="@StrategyInitDto" OnValidSubmit="ValidateForm">
                        <DataAnnotationsValidator/>
                        <ValidationSummary/>
                        <div class="form-group">
                            <SfDropDownList ID="strategyType" @bind-Value="@StrategyInitDto.StrategyFileDto" Placeholder="Strategy" FloatLabelType="FloatLabelType.Auto" Width="300px" DataSource="@StrategyTypes" TItem="StrategyFileDto" TValue="StrategyFileDto">
                                <DropDownListFieldSettings Text="@nameof(StrategyFileDto.Name)"></DropDownListFieldSettings>
                            </SfDropDownList>
                        </div>
                        <div class="form-group">
                            <SfAutoComplete EnableVirtualization="true" ID="symbolType" @bind-Value="@StrategyInitDto.Symbol" Placeholder="Select symbol" FloatLabelType="FloatLabelType.Auto" Width="300px" DataSource="@Symbols" TValue="string" TItem="SymbolInfo">
                                <AutoCompleteFieldSettings Value="@nameof(SymbolInfo.Symbol)"></AutoCompleteFieldSettings>
                            </SfAutoComplete>
                        </div>
                        <div class="form-group">
                            <SfDropDownList ID="timeFrameList" @bind-Value="@StrategyInitDto.Timeframe" Placeholder="Timeframe" FloatLabelType="FloatLabelType.Auto" Width="300px" DataSource="@TimeFrames" TValue="Timeframe" TItem="string"/>
                        </div>
                        <div class="form-group">
                            <SfDropDownList ID="timeFrameList2" @bind-Value="@StrategyInitDto.Timeframe2" Placeholder="Timeframe" FloatLabelType="FloatLabelType.Auto" Width="300px" DataSource="@TimeFrames" TValue="Timeframe" TItem="string"/>
                        </div>
                        <div class="mt-3">
                            <SfButton @onclick="OnSubmitClicked">Submit</SfButton>
                            <SfButton @onclick="OnBacktestClicked">Backtest</SfButton>
                        </div>
                    </EditForm>
                </div>
                <div style="flex: 1;">
                    @if (BacktestResult is not null)
                    {
                        <p>Resultats backtest @StrategyInitDto.StrategyFileDto @StrategyInitDto.Symbol @StrategyInitDto.Timeframe</p>
                        <ResultComponent ResultData="BacktestResult"/>
                    }
                </div>
            </div>
        }

    </div>
    <div id="container">
        <SfSpinner @bind-Visible="@OnLoading"/>
    </div>

</div>


@code {

}